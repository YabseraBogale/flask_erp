{% extends "base.html" %}

{% block title %}
  <title>Employee Lisiting</title>
{% endblock %}

{% block content %}
<div class="container">
        <div class="row">
            <div class="col-md-12 page-header">
                <div class="page-pretitle">Employee Lisiting</div>
        </div>
        <div class="content">
                <div class="container">
                    <div class="col-md-12 col-lg-12">
                            <div class="card">
                               
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Number</th>
                                                    <th>
                                                        Employee Name <input type="text" name="name" placeholder="Employee Name" class="form-control">
                                                    </th>
                                                    <th>Phonenumber</th>
                                                    <th>Poistion</th>
                                                    <th>
                                                        Department
                                                        <select name="" id="department" class="form-select">
                                                            {% for i in db_department %}
                                                                <option value="{{i[0]}}">{{i[0]}}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </th>
                                                    <th>Salary</th>
                                                    <th>Bank Account Number</th>
                                                    <th>View Full info</th>
                                                </tr>
                                            </thead>
                                            <tbody id="employee_list">
                                                
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                    </div>
                </div>   
        </div>
</div>
<script>

    fetch("/all/employee/data")
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(
            data => {
                let employee_list=document.getElementById("employee_list")
                let department=document.getElementById("department")
                let td=""
                

                department.addEventListener("change",function(event){
                    
                    
                    for(let i=0;i<data.length;i++){
                        
                        if(event.target.value==data[i]["department_name"]){
                            console.log(event.target.value);
                            td+="<tr><td>"+(i+1).toString()+"</td>"
                            td+="<td>"+data[i]["firstname"]+" "+data[i]["lastname"] +"</td>"
                            td+="<td>"+data[i]["phonenumber"]+"</td>"
                            td+="<td>"+data[i]["department_name"]+"</td>"
                            td+="<td>"+data[i]["position"]+"</td>"
                            td+="<td>"+data[i]["salary"]+"</td>"
                            td+="<td>"+data[i]["bank_account_number"]+"</td>"
                            td+="<td>"+"<a href='//employee_info_for_hr/"+data[i]["employee_tin_number"]+"' class='btn btn-primary'>View</a>"+"</td></tr>"
                            employee_list.innerHTML=td
                            td=""
                        } else{
                            employee_list.innerHTML = '<tr><td colspan="8">No employees found in this department.</td></tr>';
                            td=""
                        }
                            
                    }
                    
                })
                
                for(let i=0;i<data.length;i++){
                        
                        if("Administration"==data[i]["department_name"]){
                            
                            td+="<tr><td>"+(i+1).toString()+"</td>"
                            td+="<td>"+data[i]["firstname"]+" "+data[i]["lastname"] +"</td>"
                            td+="<td>"+data[i]["phonenumber"]+"</td>"
                            td+="<td>"+data[i]["department_name"]+"</td>"
                            td+="<td>"+data[i]["position"]+"</td>"
                            td+="<td>"+data[i]["salary"]+"</td>"
                            td+="<td>"+data[i]["bank_account_number"]+"</td>"
                            td+="<td>"+"<a href='/employee/"+data[i]["employee_tin_number"]+"' class='btn btn-primary'>View</a>"+"</td></tr>"
                            employee_list.innerHTML=td
                            td=""
                        } else{
                            employee_list.innerHTML = '<tr><td colspan="8">No employees found in this department.</td></tr>';
                            td=""
                        }
                            
                    }
                
                
                
                
            }
        )
        .catch((error)=>{
            console.log(error);
        });
</script>
<script src="{{url_for('static',filename='datatables/datatables.min.js')}}"></script>
<script src="{{url_for('static',filename='js/initiate-datatables.js')}}"></script>
<script src="{{url_for('static',filename='js/script.js')}}"></script>  
{% endblock %}
